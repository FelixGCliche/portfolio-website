@use 'sass:map';
@use '_breakpoints' as layout;

$default-columns: (
  'large': 12,
  'medium': 8,
  'small': 8,
  'xsmall': 4
);
$column-width: 72px;
$default-margin: (
  'large': 24px,
  'medium': 24px,
  'small': 16px,
  'xsmall': 32px
);
$default-gutter: (
  'large': 24px,
  'medium': 24px,
  'small': 16px,
  'xsmall': 16px
);
$default-span: 4 !default;

@mixin _layout-grid-base($size, $columns) {
  display: grid;
  grid-gap: map.get($default-gutter, $size);
  grid-template-columns: repeat($columns, $column-width);
  @if ($size == 'xsmall') {
    grid-template-columns: repeat($columns, 1fr);
  }
  @content;
}

@mixin layout-grid {
  @each $size in map.keys($default-columns) {
    @include layout.media-query($size) {
      @include _layout-grid-base($size, map.get($default-columns, $size)) {
        justify-content: center;

        @if ($size == 'xsmall') {
          margin: 0 map.get($default-margin, $size);
        }
      }
      @content;
    }
  }
}

@mixin _layout-grid-inner($columns) {
  @each $size in map.keys($default-columns) {
    @include layout.media-query($size) {
      @include _layout-grid-base($size, map.get($columns, $size)) {
        justify-content: center;
      }
      @content;
    }
  }
}

@mixin layout-grid-cell($span: $default-span) {
  grid-column-end: span $span;
  @include _layout-grid-inner($span);
  @content;
}

@mixin layout-grid-cell-full($margins: true) {
  @each $size in map.keys($default-columns) {
    @include layout.media-query($size) {
      @include _layout-grid-cell(map.get($columns, $size)) {
        @if ($size == 'xsmall' && $margins) {
          margin: calc(map.get($default-margin, $size) * -1);
        }
      }
    }
  }
  @content;
}

@mixin layout-grid-cell-half($margins: true) {
  @each $size in map.keys($default-columns) {
    @include layout.media-query($size) {
      $span: calc(map.get($columns, $size) / 2);
      @include _layout-grid-cell($span) {
        @if ($size == 'xsmall' && $margins) {
          margin: calc(map.get($default-margin, $size) * -1);
        }
      }
    }
  }
  @content;
}
